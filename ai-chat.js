const chatForm = document.getElementById('chat-form');
const chatInput = document.getElementById('chat-input');
const chatBox = document.getElementById('chat-box');
const regenBtn = document.getElementById('regen-btn'); // –∫–Ω–æ–ø–∫–∞ "–µ—â—ë –æ—Ç–≤–µ—Ç" (–µ—Å–ª–∏ –µ—Å—Ç—å)

// –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
let chatHistory = [];

// –ü—Ä–æ—Å—Ç–∞—è NLP-–ª–æ–≥–∏–∫–∞: –Ω–µ—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∫ –æ–ø–µ—á–∞—Ç–∫–∞–º (ignoreCase + —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
function match(msg, patterns) {
  const normalized = msg.toLowerCase().replace(/[^–∞-—èa-z\s]/gi, '');
  return patterns.some(p => normalized.match(p));
}

// –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
const responses = [
  { patterns: [/–ø—Ä–∏–≤–µ—Ç/i, /hi/i, /hello/i], replies: ["–ü—Ä–∏–≤–µ—Ç! üòé","–•–∞–π! –ö–∞–∫ –¥–µ–ª–∞?","–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π!","–ü—Ä–∏–≤–µ—Ç, —Ä–∞–¥ —Ç–µ–±—è –≤–∏–¥–µ—Ç—å!","–ü—Ä–∏–≤–µ—Ç! –ß—Ç–æ –Ω–æ–≤–æ–≥–æ?"] },
  { patterns: [/–∫–∞–∫ –¥–µ–ª–∞/i, /how are you/i], replies: ["–£ –º–µ–Ω—è –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ! –ê —É —Ç–µ–±—è?","–í—Å—ë —Å—É–ø–µ—Ä! –ö–∞–∫ –¥–µ–Ω—å –ø—Ä–æ—à—ë–ª?","–ù–æ—Ä–º–∞–ª—å–Ω–æ, –∞ —É —Ç–µ–±—è?","–û—Ç–ª–∏—á–Ω–æ! –ß—Ç–æ –¥–µ–ª–∞–µ—à—å?","–í—Å–µ —Ö–æ—Ä–æ—à–æ, –∞ —Ç—ã?"] },
  { patterns: [/—á—Ç–æ —É–º–µ–µ—à—å/i, /what can you do/i], replies: ["–Ø –º–æ–≥—É —Å —Ç–æ–±–æ–π –±–æ–ª—Ç–∞—Ç—å –∏ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã!","–ú–æ–≥—É –æ–±—Å—É–∂–¥–∞—Ç—å —Ñ—É—Ç–±–æ–ª, –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏–≥—Ä—ã.","–Ø —É—á—É—Å—å –ø–æ–Ω–∏–º–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –Ω–∏—Ö.","–ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ —Å–≤–æ–∏ –º–∏–Ω–∏-–ø—Ä–æ–µ–∫—Ç—ã.","–Ø –º–æ–≥—É –±—ã—Ç—å —Ç–≤–æ–∏–º —á–∞—Ç-–∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–º."] },
  { patterns: [/—Ñ—É—Ç–±–æ–ª/i, /football/i], replies: ["–õ—é–±–ª—é —Ñ—É—Ç–±–æ–ª! ‚öΩ –ú–æ—è –ª—é–±–∏–º–∞—è –∫–æ–º–∞–Ω–¥–∞ ‚Äî Chelsea.","–§—É—Ç–±–æ–ª –∫—Ä—É—Ç–æ–π! –ö–∞–∫—É—é –∫–æ–º–∞–Ω–¥—É –ª—é–±–∏—à—å?","–¢—Ä–µ–Ω–∏—Ä—É—é—Å—å 3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é.","–ú–æ–≥—É –æ–±—Å—É–∂–¥–∞—Ç—å —Ç–∞–∫—Ç–∏–∫—É –∏ –ø–æ–∑–∏—Ü–∏–∏.","–ú–æ—è –ª—é–±–∏–º–∞—è –ø–æ–∑–∏—Ü–∏—è ‚Äî –∑–∞—â–∏—Ç–Ω–∏–∫."] },
  { patterns: [/–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä/i, /code/i, /python/i, /js/i, /node/i], replies: ["–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –º–æ—ë —Ö–æ–±–±–∏!","–ó–Ω–∞—é HTML, CSS, JS –∏ –Ω–µ–º–Ω–æ–≥–æ Python.","–ú–æ–≥—É –ø–æ–º–æ–≥–∞—Ç—å —Å –ø—Ä–æ—Å—Ç—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏ –ø–æ –∫–æ–¥—É.","–°–æ–∑–¥–∞—é –º–∏–Ω–∏-–∏–≥—Ä—ã –Ω–∞ JS –∏ Python.","–õ—é–±–ª—é —É—á–∏—Ç—å—Å—è –Ω–æ–≤—ã–º —è–∑—ã–∫–∞–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è."] },
  { patterns: [/–∏–≥—Ä—ã/i, /games/i], replies: ["–õ—é–±–ª—é –∏–≥—Ä–∞—Ç—å –≤ –∏–≥—Ä—ã! üïπ","–ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ —Å–≤–æ–∏ –º–∏–Ω–∏-–∏–≥—Ä—ã –Ω–∞ JS –∏ Python.","–ö–∞–∫–∞—è —Ç–≤–æ—è –ª—é–±–∏–º–∞—è –∏–≥—Ä–∞?","–ü—Ä–æ–±—É—é —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ –º–∞–ª–µ–Ω—å–∫–∏–µ –∏–≥—Ä—ã.","–Ø –∏–∑—É—á–∞—é –≥–µ–π–º–¥–µ–≤ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ."] },
  { patterns: [/–∫–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç/i, /who are you/i], replies: ["–Ø –Ω–∞—à —à–∫–æ–ª—å–Ω—ã–π –ò–ò!","–ú–æ–∂–µ—à—å –∑–≤–∞—Ç—å –º–µ–Ω—è –ß–∞—Ç-–ò–ò.","–Ø —Ç–≤–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫.","–Ø –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –±–æ–ª—Ç–∞—Ç—å —Å —Ç–æ–±–æ–π.","–ü—Ä–∏—è—Ç–Ω–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è!"] },
  { patterns: [/–ø–æ–∫–∞/i, /bye/i, /exit/i], replies: ["–ü–æ–∫–∞! –ë—ã–ª–æ –ø—Ä–∏—è—Ç–Ω–æ –ø–æ–æ–±—â–∞—Ç—å—Å—è.","–î–æ –≤—Å—Ç—Ä–µ—á–∏!","–ü—Ä–æ—â–∞–π!","–î–æ —Å–∫–æ—Ä–æ–≥–æ!","–£–≤–∏–¥–∏–º—Å—è!"] },
  { patterns: [/—Å–ø–∞—Å–∏–±–æ/i, /thanks/i], replies: ["–ü–æ–∂–∞–ª—É–π—Å—Ç–∞! üòä","–í—Å–µ–≥–¥–∞ —Ä–∞–¥ –ø–æ–º–æ—á—å!","–û–±—Ä–∞—â–∞–π—Å—è!","–†–∞–¥ –±—ã–ª –ø–æ–º–æ—á—å!","–ù–µ –∑–∞ —á—Ç–æ!"] },
  { patterns: [/–ª—é–±–∏—à—å/i, /like/i], replies: ["–Ø –ª—é–±–ª—é –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ñ—É—Ç–±–æ–ª!","–ú–Ω–µ –Ω—Ä–∞–≤—è—Ç—Å—è –∏–≥—Ä—ã –∏ —É—á–µ–±–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã.","–õ—é–±–ª—é —É–∑–Ω–∞–≤–∞—Ç—å –Ω–æ–≤–æ–µ.","–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è –ø–æ–º–æ–≥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.","–õ—é–±–ª—é –æ–±—â–µ–Ω–∏–µ!"] },
  // –î–æ–±–∞–≤—å –µ—â—ë 40+ –ø–æ—Ö–æ–∂–∏—Ö –±–ª–æ–∫–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–µ–º –∏ —ç–º–æ—Ü–∏–π
];

// –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
function getReply(msg) {
  for (let entry of responses) {
    if (match(msg, entry.patterns)) {
      // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –æ—Ç–≤–µ—Ç
      return entry.replies[Math.floor(Math.random() * entry.replies.length)];
    }
  }
  return "–ò–∑–≤–∏–Ω–∏, —è –ø–æ–∫–∞ –Ω–µ –∑–Ω–∞—é, —á—Ç–æ –Ω–∞ —ç—Ç–æ –æ—Ç–≤–µ—Ç–∏—Ç—å üòÖ";
}

// –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
function addMessage(author, message) {
  const msgHTML = `<p><strong>${author}:</strong> ${message}</p>`;
  chatBox.innerHTML += msgHTML;
  chatBox.scrollTop = chatBox.scrollHeight;
  chatHistory.push({author, message});
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
chatForm.addEventListener('submit', e => {
  e.preventDefault();
  const userMsg = chatInput.value.trim();
  if (!userMsg) return;

  addMessage("–¢—ã", userMsg);
  chatInput.value = '';
  addMessage("–ò–ò", "...–∑–∞–≥—Ä—É–∑–∫–∞");

  setTimeout(() => {
    const botMsg = getReply(userMsg);
    chatBox.innerHTML = chatBox.innerHTML.replace('<p><strong>–ò–ò:</strong> ...–∑–∞–≥—Ä—É–∑–∫–∞</p>', `<p><strong>–ò–ò:</strong> ${botMsg}</p>`);
    chatBox.scrollTop = chatBox.scrollHeight;
  }, 400);
});

// –ö–Ω–æ–ø–∫–∞ ‚Äú—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –æ—Ç–≤–µ—Ç‚Äù (–µ—Å–ª–∏ –µ—Å—Ç—å)
if (regenBtn) {
  regenBtn.addEventListener('click', () => {
    if (chatHistory.length === 0) return;
    const lastUser = chatHistory.slice().reverse().find(m => m.author === "–¢—ã");
    if (!lastUser) return;
    const newReply = getReply(lastUser.message);
    addMessage("–ò–ò", newReply);
  });
}
